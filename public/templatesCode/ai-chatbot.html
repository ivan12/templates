<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot - Chat Interface</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white">
  <div class="flex h-screen">
    <aside class="w-64 border-r border-slate-800 p-4 flex flex-col">
      <button data-new-chat class="w-full bg-blue-600 py-2 rounded-lg mb-4 hover:bg-blue-700">+ New Chat</button>
      <div class="space-y-2 flex-1 overflow-auto" data-chat-list></div>
      <div class="mt-4 text-xs text-slate-400">AI Assistant v2.1</div>
    </aside>

    <main class="flex-1 flex flex-col">
      <header class="border-b border-slate-800 p-4 flex items-center justify-between">
        <div>
          <h1 class="text-xl font-semibold">AI Assistant</h1>
          <p class="text-xs text-slate-400">Ask anything. Get answers in seconds.</p>
        </div>
        <button data-clear-chat class="text-sm text-slate-300 hover:text-white">Clear</button>
      </header>

      <div class="flex-1 overflow-y-auto p-6 space-y-6" data-chat-feed></div>

      <form class="border-t border-slate-800 p-4" data-chat-form>
        <div class="flex gap-2">
          <input name="message" type="text" placeholder="Type your message..." class="flex-1 bg-slate-900 border border-slate-800 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-600" />
          <button class="bg-blue-600 px-6 py-3 rounded-lg hover:bg-blue-700" type="submit">Send</button>
        </div>
      </form>
    </main>
  </div>

  <script>
    const feed = document.querySelector("[data-chat-feed]")
    const form = document.querySelector("[data-chat-form]")
    const clearButton = document.querySelector("[data-clear-chat]")
    const newButton = document.querySelector("[data-new-chat]")
    const chatList = document.querySelector("[data-chat-list]")
    const storageKey = "demo-ai-chat-conversations"
    const defaultConversations = [
      {
        id: "conv-1",
        title: "Product Ideas",
        updatedAt: Date.now() - 1000 * 60 * 120,
        messages: [
          { text: "Hey! Let's brainstorm a few product ideas.", isUser: false },
          { text: "I want something for creators.", isUser: true },
          { text: "Nice. What about a micro-course builder with templates?", isUser: false },
        ],
      },
      {
        id: "conv-2",
        title: "Marketing Strategy",
        updatedAt: Date.now() - 1000 * 60 * 60 * 24,
        messages: [
          { text: "Let's craft a go-to-market plan. Who is the target audience?", isUser: false },
          { text: "Indie founders shipping SaaS.", isUser: true },
          { text: "Great. We'll focus on Twitter + Product Hunt launch.", isUser: false },
        ],
      },
      {
        id: "conv-3",
        title: "Code Review",
        updatedAt: Date.now() - 1000 * 60 * 60 * 48,
        messages: [
          { text: "Share the code and I will review it.", isUser: false },
          { text: "Here is the repo link.", isUser: true },
          { text: "I will start with performance and accessibility.", isUser: false },
        ],
      },
    ]
    let conversations = loadConversations()
    let activeId = conversations[0]?.id || ""

    function loadConversations() {
      try {
        const raw = localStorage.getItem(storageKey)
        if (!raw) return defaultConversations
        const parsed = JSON.parse(raw)
        if (Array.isArray(parsed)) {
          return parsed.map((conv) => ({
            id: String(conv.id),
            title: String(conv.title || "New Chat"),
            updatedAt: Number(conv.updatedAt) || Date.now(),
            messages: Array.isArray(conv.messages)
              ? conv.messages.map((message) => ({ text: String(message.text), isUser: !!message.isUser }))
              : [],
          }))
        }
      } catch (error) {
        return defaultConversations
      }
      return defaultConversations
    }

    function saveConversations() {
      try {
        localStorage.setItem(storageKey, JSON.stringify(conversations))
      } catch (error) {
        return
      }
    }

    function formatTime(timestamp) {
      const diff = Date.now() - timestamp
      const minutes = Math.floor(diff / 60000)
      if (minutes < 60) return minutes + " min ago"
      const hours = Math.floor(minutes / 60)
      if (hours < 24) return hours + " hours ago"
      const days = Math.floor(hours / 24)
      if (days === 1) return "Yesterday"
      return days + " days ago"
    }

    function getActiveConversation() {
      return conversations.find((conv) => conv.id === activeId)
    }

    function renderChatList() {
      chatList.innerHTML = ""
      conversations
        .slice()
        .sort((a, b) => b.updatedAt - a.updatedAt)
        .forEach((conv) => {
          const button = document.createElement("button")
          const isActive = conv.id === activeId
          button.className =
            "w-full text-left p-3 rounded-lg " +
            (isActive ? "bg-slate-900 border border-slate-800" : "hover:bg-slate-900")
          button.setAttribute("data-chat", conv.id)
          button.innerHTML =
            '<p class="text-sm font-medium">' + conv.title + "</p>" +
            '<p class="text-xs text-slate-400">' + formatTime(conv.updatedAt) + "</p>"
          button.addEventListener("click", () => {
            activeId = conv.id
            renderChatList()
            renderMessages()
          })
          chatList.appendChild(button)
        })
    }

    function buildMessageElement(message) {
      const wrapper = document.createElement("div")
      const alignment = message.isUser ? "flex-row-reverse" : ""
      wrapper.className = "flex gap-4 " + alignment
      const avatarClass = message.isUser ? "bg-emerald-600" : "bg-blue-600"
      const bubbleClass = message.isUser ? "bg-blue-900/40" : "bg-slate-900"
      wrapper.innerHTML =
        '<div class="w-8 h-8 ' + avatarClass + ' rounded-full flex-shrink-0"></div>' +
        '<div class="' + bubbleClass + ' rounded-xl p-4 max-w-2xl">' + message.text + "</div>"
      return wrapper
    }

    function renderMessages() {
      feed.innerHTML = ""
      const conversation = getActiveConversation()
      if (!conversation) return
      conversation.messages.forEach((message) => {
        feed.appendChild(buildMessageElement(message))
      })
      feed.scrollTop = feed.scrollHeight
    }

    function addMessage(text, isUser) {
      const conversation = getActiveConversation()
      if (!conversation) return
      conversation.messages.push({ text, isUser })
      conversation.updatedAt = Date.now()
      saveConversations()
      renderChatList()
      renderMessages()
    }

    renderChatList()
    renderMessages()

    form.addEventListener("submit", (event) => {
      event.preventDefault()
      const input = form.querySelector("input[name='message']")
      const value = input.value.trim()
      if (!value) return
      addMessage(value, true)
      input.value = ""
      setTimeout(() => {
        addMessage("Got it. I can draft a plan or generate examples. Want a quick outline?", false)
      }, 500)
    })

    clearButton.addEventListener("click", () => {
      const conversation = getActiveConversation()
      if (!conversation) return
      conversation.messages = []
      conversation.updatedAt = Date.now()
      saveConversations()
      renderMessages()
      renderChatList()
    })

    newButton.addEventListener("click", () => {
      const id = "conv-" + Date.now()
      const newConversation = {
        id,
        title: "New Chat",
        updatedAt: Date.now(),
        messages: [{ text: "New chat started. What should we explore?", isUser: false }],
      }
      conversations.unshift(newConversation)
      activeId = id
      saveConversations()
      renderChatList()
      renderMessages()
    })
  </script>
</body>
</html>
